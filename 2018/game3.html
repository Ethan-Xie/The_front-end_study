<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>game 1</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body{
            border:1px red solid;
        }
        #id-canvas{
            border:1px black solid;
        }
    </style>
</head>
<body>
    
    <canvas id="id-canvas" width="400" height="600"></canvas>
</body>
<script>
    var log = console.log.bind(console);


    var imageFromPath = function(path){
        var img = new Image();
        img.src= path;
        return img;
    }
    var Paddle = function (){
        var image = imageFromPath("../lib/1.jpg");
        var o = {
            image : image,
            x : 100,
            y : 200,
            speed : 6,
            leftDown : false,
            rightDown : false,
        }
        o.moveLeft = function(){
            this.x -= this.speed;
        }
        o.moveRight = function(){
            this.x += this.speed;
        }
        return o;
    }

    var GuaGame = function() {
        var g = {
            actions: {},
        };
        var canvas = document.querySelector("#id-canvas");
        var context = canvas.getContext('2d');
        g.canvas =canvas;
        g.context = context;
        log("Guamame");
       
        setInterval(function(){
            log(g.update);
            //update
            g.update();
            context.clearRect(0,0,canvas.width,canvas.height);
            //draw
            g.draw();
        },1000/50);
        log(g.update);
        return g;
    }
    
    var __main =function() {
        var game=GuaGame();
        var paddle=Paddle();
        var img = paddle.image;

        var leftDown = false;
        var rightDown = false;


        img.onload = function(){
            game.context.drawImage(img,paddle.x,paddle.y);
        }
        //events
        window.addEventListener('keydown',function(event){
            var k = event.key;
            if(k == 'a'){
                leftDown = true;
            }else if(k == 'd'){
                rightDown = true;
            }
            log(event.type)
        })

        window.addEventListener('keyup',function(event){
            var k = event.key;
            if(k == 'a'){
                leftDown = false;
            }else if(k == 'd'){
                rightDown = false;
            }
            log(event.type)
        })
        game.update = function(){
            log("game.update")
                 // update x
            if(leftDown){
                //向左移动
                paddle.moveLeft()
            }else if(rightDown){ 
                //向右移动
                paddle.moveRight()
            }
        }
        game.draw = function(){
            log("game.draw")
            //draw 
            game.context.drawImage(img,paddle.x,paddle.y);
        }
        log("main")
    }
    
    __main();
    /*
        / shim layer with setTimeout fallback
        window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                function( callback ){
                    window.setTimeout(callback, 1000 / 60);
                };
        })();


        // usage:
        // instead of setInterval(render, 16) ....

        (function animloop(){
        requestAnimFrame(animloop);
        render();
        })();
        // place the rAF *before* the render() to assure as close to
        // 60fps with the setTimeout fallback.
    */
</script>
</html>